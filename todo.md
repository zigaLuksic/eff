Fix covariance and contravariance in type definitions.

Fix shady unit type stuff

Add better support for equations


           